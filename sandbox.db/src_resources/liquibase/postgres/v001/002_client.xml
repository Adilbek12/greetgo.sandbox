<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

  <changeSet author="nsmagulov" id="create-sequence-client-id">
    <sql endDelimiter=";;"><![CDATA[
      CREATE SEQUENCE client_id_seq
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-table-client">
    <sql endDelimiter=";;"><![CDATA[
      CREATE TABLE client (
        id          bigint DEFAULT nextval('client_id_seq') NOT NULL PRIMARY KEY,
        surname     varchar(255) NOT NULL,
        name        varchar(255) NOT NULL,
        patronymic  varchar(255) NOT NULL,
        gender      varchar(255) NOT NULL,
        birth_date  date NOT NULL,
        charm       integer NOT NULL,
        disabled    boolean NOT NULL DEFAULT false
      )
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-sequence-charm-id">
    <sql endDelimiter=";;"><![CDATA[
      CREATE SEQUENCE charm_id_seq
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-table-charm">
    <sql endDelimiter=";;"><![CDATA[
      CREATE TABLE charm (
        id          integer DEFAULT nextval('charm_id_seq') NOT NULL PRIMARY KEY,
        name        varchar(255) NOT NULL,
        description varchar(255) NOT NULL,
        energy      real NOT NULL,
        disabled    boolean NOT NULL DEFAULT false
      )
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="alter-table-client-add-foreign-key">
    <sql endDelimiter=";;"><![CDATA[
      ALTER TABLE client
      ADD CONSTRAINT fk_Client_Charm
      FOREIGN KEY (charm)
      REFERENCES charm(id)
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-table-client_addr">
    <sql endDelimiter=";;"><![CDATA[
      CREATE TABLE client_addr (
        client  bigint NOT NULL REFERENCES client(id),
        type    varchar(255) NOT NULL,
        street  varchar(255) NOT NULL,
        house   varchar(255) NOT NULL,
        flat    varchar(255) NOT NULL,
        PRIMARY KEY (client, type)
      )
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-table-client_phone">
    <sql endDelimiter=";;"><![CDATA[
      CREATE TABLE client_phone (
        client  bigint NOT NULL REFERENCES client(id),
        number  varchar(255) NOT NULL,
        type    varchar(255) NOT NULL,
        PRIMARY KEY (client, number)
      )
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-sequence-client_account-id">
    <sql endDelimiter=";;"><![CDATA[
      CREATE SEQUENCE client_account_id_seq
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-table-client_account">
    <sql endDelimiter=";;"><![CDATA[
      CREATE TABLE client_account (
        id            bigint DEFAULT nextval('client_account_id_seq') NOT NULL PRIMARY KEY,
        client        bigint NOT NULL REFERENCES client(id),
        money         real NOT NULL,
        number        varchar(255) NOT NULL,
        registered_at timestamp NOT NULL
      )
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-sequence-client_account_transaction-id">
    <sql endDelimiter=";;"><![CDATA[
      CREATE SEQUENCE client_account_transaction_id_seq
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-table-client_account_transaction">
    <sql endDelimiter=";;"><![CDATA[
      CREATE TABLE client_account_transaction (
        id            bigint DEFAULT nextval('client_account_transaction_id_seq') NOT NULL PRIMARY KEY,
        account       bigint NOT NULL REFERENCES client_account(id),
        money         real NOT NULL,
        finished_at   timestamp NOT NULL,
        type integer  NOT NULL
      )
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-sequence-transaction_type-id">
    <sql endDelimiter=";;"><![CDATA[
      CREATE SEQUENCE transaction_type_id_seq
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="create-table-Transaction_Type">
    <sql endDelimiter=";;"><![CDATA[
      CREATE TABLE transaction_type (
        id    integer DEFAULT nextval('transaction_type_id_seq') NOT NULL PRIMARY KEY,
        code  varchar(255) NOT NULL,
        name  varchar(255) NOT NULL
      )
    ]]></sql>
  </changeSet>

  <changeSet author="nsmagulov" id="alter-table-client_account_transaction-add-foreign-key">
    <sql endDelimiter=";;"><![CDATA[
      ALTER TABLE client_account_transaction
      ADD CONSTRAINT fk_clientAccountTransaction_transactionType
      FOREIGN KEY (type)
      REFERENCES Transaction_Type(id)
    ]]></sql>
  </changeSet>
</databaseChangeLog>
